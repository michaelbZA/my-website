<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Part 8: Testing & Debugging Python Code | Michael Brunger</title>
<meta name=keywords content="python,testing,unittest,pytest,debugging,pdb,exceptions,logging,TDD"><meta name=description content="Master unit testing with unittest and pytest, learn Test-Driven Development workflows, handle custom exceptions, use the debugger effectively, and implement structured logging."><meta name=author content="Michael Brunger"><link rel=canonical href=http://localhost:1313/python-testing-debugging/><link crossorigin=anonymous href=http://localhost:1313/assets/css/stylesheet.c4cc1e21a445bb0fda61df68a1d9b952b1dcb9bd38d5ca41d3ba642d5b5c1607.css integrity="sha256-xMweIaRFuw/aYd9oodm5UrHcub041cpB07pkLVtcFgc=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/python-testing-debugging/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=text/javascript src='https://app.cookieyes.com/mAsBCNFb37oPK_4XJgj7kpxbljvjKgiPcLeSeiRyslQSWcJQA0P7w_nb-e_NfuwZCdsSDi_gh_1zVLQNUSNV8A=='></script><script id=cookieyes type=text/javascript src=https://cdn-cookieyes.com/client_data/8dbaf9037ea60d809e6f1613/script.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Orbitron:wght@400..900&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-XJJLP6S9JL" data-cookieyes=cookieyes-analytics></script><script data-cookieyes=cookieyes-analytics>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XJJLP6S9JL")</script><script src=http://localhost:1313/js/extended/back-to-top.min.js defer></script><script src=http://localhost:1313/js/extended/sticky-header.min.js defer></script><script src=http://localhost:1313/js/extended/menu-trigger.min.js defer></script><meta property="og:url" content="http://localhost:1313/python-testing-debugging/"><meta property="og:site_name" content="Michael Brunger"><meta property="og:title" content="Part 8: Testing & Debugging Python Code"><meta property="og:description" content="Master unit testing with unittest and pytest, learn Test-Driven Development workflows, handle custom exceptions, use the debugger effectively, and implement structured logging."><meta property="og:locale" content="en-GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-19T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-09T14:44:55+01:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Unittest"><meta property="article:tag" content="Pytest"><meta property="article:tag" content="Debugging"><meta property="article:tag" content="Pdb"><meta property="og:image" content="http://localhost:1313/site-feature-image.jpg"><meta property="og:see_also" content="http://localhost:1313/python-next-steps-advanced-topics/"><meta property="og:see_also" content="http://localhost:1313/simple-gui-applications-tkinter/"><meta property="og:see_also" content="http://localhost:1313/python-web-development-foundations/"><meta property="og:see_also" content="http://localhost:1313/introduction-object-oriented-programming-python/"><meta property="og:see_also" content="http://localhost:1313/python-data-visualisation-basics/"><meta property="og:see_also" content="http://localhost:1313/data-analysis-with-pandas/"><meta property="og:see_also" content="http://localhost:1313/numpy-fundamentals-numerical-data/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/site-feature-image.jpg"><meta name=twitter:title content="Part 8: Testing & Debugging Python Code"><meta name=twitter:description content="Master unit testing with unittest and pytest, learn Test-Driven Development workflows, handle custom exceptions, use the debugger effectively, and implement structured logging."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Python Series","item":"http://localhost:1313/posts/python-series/"},{"@type":"ListItem","position":3,"name":"Part 8: Testing \u0026 Debugging Python Code","item":"http://localhost:1313/python-testing-debugging/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Part 8: Testing \u0026 Debugging Python Code","name":"Part 8: Testing \u0026 Debugging Python Code","description":"Master unit testing with unittest and pytest, learn Test-Driven Development workflows, handle custom exceptions, use the debugger effectively, and implement structured logging.","keywords":["python","testing","unittest","pytest","debugging","pdb","exceptions","logging","TDD"],"articleBody":"Testing \u0026 Debugging: Building Reliable Financial Tools When working with financial data and calculations, accuracy isn’t just important—it’s essential. A small bug in your code could mean reporting incorrect figures, making flawed investment decisions, or even compliance issues. This post will guide you through testing and debugging techniques that ensure your financial Python code works correctly and reliably.\nWhy Testing Matters in Finance Imagine you’ve created a Python script that calculates loan amortisation schedules. Your company uses this tool to price thousands of loans. If there’s an error in your interest calculation logic, even a small one, the financial impact could be enormous.\nAs a finance professional, you need confidence in your code. Testing provides that confidence by systematically verifying that your calculations work correctly across a range of scenarios and edge cases.\nUnit Testing Basics Unit testing involves testing individual components (usually functions) in isolation to ensure they work as expected.\nGetting Started with unittest Python’s built-in unittest framework provides all the tools you need for basic testing. Let’s test our financial ratio calculator from the previous post:\nFirst, create a file called test_ratio_calculator.py:\nimport unittest from ratio_calculator import calculate_current_ratio, calculate_debt_to_equity class TestFinancialRatios(unittest.TestCase): def test_current_ratio(self): # Test basic calculation self.assertEqual(calculate_current_ratio(100000, 50000), 2.0) # Test with zero liabilities - should raise ValueError with self.assertRaises(ValueError): calculate_current_ratio(100000, 0) def test_debt_to_equity(self): # Test basic calculation self.assertEqual(calculate_debt_to_equity(200000, 400000), 0.5) # Test highly leveraged company self.assertEqual(calculate_debt_to_equity(800000, 200000), 4.0) # Test with zero equity - should raise ValueError with self.assertRaises(ValueError): calculate_debt_to_equity(100000, 0) if __name__ == '__main__': unittest.main() Run the tests with:\npython test_ratio_calculator.py If all tests pass, you’ll see something like:\n..\r----------------------------------------------------------------------\rRan 2 tests in 0.001s\rOK If a test fails, unittest will tell you which test failed and why, helping you pinpoint the issue.\nCommon Assertions in unittest Here are some assertions particularly useful for financial calculations:\n# Checking exact equality self.assertEqual(calculate_npv(cash_flows, 0.1), 1025.79) # Checking approximate equality (for floating point calculations) self.assertAlmostEqual(calculate_irr([-1000, 500, 600]), 0.0734, places=4) # Checking if a value is greater than another self.assertGreater(calculate_profit_margin(revenue, costs), 0) # Checking if an exception is raised for invalid inputs with self.assertRaises(ValueError): calculate_pe_ratio(stock_price=50, earnings_per_share=0) Moving to pytest While unittest is perfectly capable, pytest offers a more modern and flexible approach to testing. Let’s see how we might test the same functions with pytest:\nInstall pytest: pip install pytest Create a file named test_ratios_pytest.py: import pytest from ratio_calculator import calculate_current_ratio, calculate_debt_to_equity def test_current_ratio_basic(): assert calculate_current_ratio(100000, 50000) == 2.0 def test_current_ratio_zero_liabilities(): with pytest.raises(ValueError): calculate_current_ratio(100000, 0) def test_debt_to_equity_basic(): assert calculate_debt_to_equity(200000, 400000) == 0.5 def test_debt_to_equity_high_leverage(): assert calculate_debt_to_equity(800000, 200000) == 4.0 def test_debt_to_equity_zero_equity(): with pytest.raises(ValueError): calculate_debt_to_equity(100000, 0) Run the tests: pytest test_ratios_pytest.py -v The -v flag gives you verbose output showing each test that was run.\nThe Power of pytest Fixtures One of pytest’s most powerful features is fixtures, which let you set up preconditions for your tests. This is especially useful for financial testing where you might have complex data structures:\nimport pytest from financial_analyzer import StockAnalyzer @pytest.fixture def sample_stock_data(): # Return a sample dataset that can be used by multiple tests return { 'ticker': 'AAPL', 'prices': [150.25, 151.30, 149.80, 152.50, 153.75], 'volumes': [12345678, 9876543, 11234567, 10234567, 13456789], 'financials': { 'revenue': 365.82, # In billions 'net_income': 94.68, # In billions 'total_assets': 351.0, # In billions 'total_liabilities': 287.91, # In billions 'shareholders_equity': 63.09 # In billions } } def test_pe_ratio_calculation(sample_stock_data): analyzer = StockAnalyzer(sample_stock_data) # Assuming current price is the last in the list and EPS is net_income / outstanding_shares # For this example, let's say outstanding_shares is 16.07B expected_pe = 150.25 / (94.68 / 16.07) assert round(analyzer.calculate_pe_ratio(), 2) == round(expected_pe, 2) def test_debt_to_equity_ratio(sample_stock_data): analyzer = StockAnalyzer(sample_stock_data) expected_ratio = 287.91 / 63.09 assert round(analyzer.calculate_debt_to_equity(), 2) == round(expected_ratio, 2) This way, you set up your test data once and reuse it across multiple tests.\nParameterised Tests for Multiple Scenarios Financial calculations often need to be tested with multiple sets of inputs. Pytest’s parameterisation makes this elegant:\nimport pytest from finance_calcs import calculate_compound_interest @pytest.mark.parametrize(\"principal,rate,time,compounding,expected\", [ (1000, 0.05, 5, 1, 1276.28), # Annual compounding (1000, 0.05, 5, 12, 1283.36), # Monthly compounding (1000, 0.05, 5, 365, 1284.52), # Daily compounding ]) def test_compound_interest(principal, rate, time, compounding, expected): result = calculate_compound_interest(principal, rate, time, compounding) assert round(result, 2) == expected This tests our compound interest function with annual, monthly, and daily compounding periods, all in a single test function.\nTest-Driven Development (TDD) for Finance Test-Driven Development is a methodology where you write tests before you write code. For financial calculations, this approach can be particularly beneficial:\nWrite the test first: Define what your function should do before implementing it Run the test and watch it fail: Confirm the test works Write the implementation: Create the function to make the test pass Run the test again: Verify your implementation works Refactor: Clean up your code while ensuring tests continue to pass A TDD Example: Calculating EBITDA Let’s say we need to add an EBITDA calculation function. Following TDD:\nFirst, write the test: # test_financial_metrics.py import pytest from financial_metrics import calculate_ebitda def test_calculate_ebitda(): # EBITDA = Net Income + Interest + Taxes + Depreciation + Amortisation income_statement = { 'net_income': 1000000, 'interest_expense': 200000, 'income_tax': 300000, 'depreciation': 150000, 'amortisation': 50000 } expected_ebitda = 1700000 # Sum of all the components assert calculate_ebitda(income_statement) == expected_ebitda Run the test (it will fail since we haven’t implemented the function yet): pytest test_financial_metrics.py Implement the function: # financial_metrics.py def calculate_ebitda(income_statement): \"\"\" Calculate EBITDA from income statement components. Args: income_statement (dict): Dictionary containing income statement items Returns: float: EBITDA value \"\"\" return ( income_statement['net_income'] + income_statement['interest_expense'] + income_statement['income_tax'] + income_statement['depreciation'] + income_statement['amortisation'] ) Run the test again - it should pass now! Debugging Financial Code Even with tests, bugs will sometimes creep into your code. Let’s explore techniques to find and fix them.\nPrint-Driven Debugging The simplest debugging technique is adding print() statements to your code:\ndef calculate_loan_payment(principal, annual_rate, years): monthly_rate = annual_rate / 12 print(f\"Monthly rate: {monthly_rate}\") num_payments = years * 12 print(f\"Number of payments: {num_payments}\") payment = principal * (monthly_rate * (1 + monthly_rate) ** num_payments) / \\ ((1 + monthly_rate) ** num_payments - 1) print(f\"Calculated payment: {payment}\") return payment While simple, this approach can be effective for quick debugging sessions.\nUsing Python’s Built-in Debugger (pdb) For more complex issues, Python’s debugger (pdb) gives you interactive control:\ndef analyze_portfolio(holdings): import pdb; pdb.set_trace() # Debugger will start here total_value = 0 for ticker, data in holdings.items(): shares = data['shares'] price = data['current_price'] position_value = shares * price total_value += position_value return total_value When this code runs, it will pause at the pdb.set_trace() line and drop you into an interactive debugger. Common commands include:\nn (next): Execute the current line and move to the next one s (step): Step into a function call c (continue): Continue execution until the next breakpoint p variable_name: Print the value of a variable q (quit): Exit the debugger IDE-Based Debugging Most modern IDEs offer powerful visual debugging:\nSet a breakpoint by clicking in the margin next to your code Start the debugger (usually with a “Debug” button) The program will pause at your breakpoint Examine variables, step through code, and find issues This is particularly useful for financial applications where you need to inspect complex data structures or track down calculation errors.\nCommon Financial Code Bugs Watch out for these common issues in financial code:\nRounding errors: Financial calculations often require precise decimal handling # Problematic: Floating point imprecision 0.1 + 0.2 # Returns 0.30000000000000004 # Better: Use Decimal for financial calculations from decimal import Decimal Decimal('0.1') + Decimal('0.2') # Returns Decimal('0.3') Off-by-one errors in time periods: Check if your code correctly handles time period boundaries # Is this calculating 29 or 30 days of interest? days_in_month = 30 daily_interest = principal * (annual_rate / 365) total_interest = 0 # Potential off-by-one error for day in range(days_in_month): # This gives 0-29, so only 30 days total_interest += daily_interest Negative input validation: Financial functions often have domain restrictions def calculate_loan_payment(principal, rate, years): # Validate inputs if principal \u003c= 0: raise ValueError(\"Principal must be positive\") if rate \u003c 0: raise ValueError(\"Interest rate cannot be negative\") if years \u003c= 0: raise ValueError(\"Loan term must be positive\") # Rest of the calculation Custom Exceptions for Financial Validation Creating custom exceptions helps make your financial code more robust and self-documenting:\nclass NegativePrincipalError(ValueError): \"\"\"Raised when a negative principal amount is provided\"\"\" pass class ZeroDivisionFinancialError(ValueError): \"\"\"Raised when a financial calculation would result in division by zero\"\"\" pass def calculate_return_on_investment(gain, cost): \"\"\" Calculate ROI: (Gain - Cost) / Cost Args: gain (float): The amount gained from the investment cost (float): The cost of the investment Returns: float: ROI as a decimal Raises: NegativePrincipalError: If cost is negative ZeroDivisionFinancialError: If cost is zero \"\"\" if cost \u003c 0: raise NegativePrincipalError(\"Investment cost cannot be negative\") if cost == 0: raise ZeroDivisionFinancialError(\"Cannot calculate ROI with zero cost\") return (gain - cost) / cost These custom exceptions make error handling clearer and provide better feedback to users of your code.\nStructured Logging for Financial Applications For production financial applications, proper logging is essential for auditing and debugging:\nimport logging # Set up logging logging.basicConfig( filename='financial_calculations.log', level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s' ) def calculate_mortgage_payment(principal, rate, years): \"\"\"Calculate monthly mortgage payment\"\"\" logging.info(f\"Calculating mortgage payment: principal={principal}, rate={rate}, years={years}\") try: monthly_rate = rate / 12 num_payments = years * 12 if monthly_rate == 0: payment = principal / num_payments else: payment = principal * (monthly_rate * (1 + monthly_rate) ** num_payments) / \\ ((1 + monthly_rate) ** num_payments - 1) logging.info(f\"Calculated payment: {payment}\") return payment except Exception as e: logging.error(f\"Error calculating mortgage payment: {str(e)}\") raise This creates a log file with timestamped entries that can be invaluable for tracking down issues in complex financial applications.\nLogging Levels Different logging levels serve different purposes:\nlogging.DEBUG: Detailed information, typically useful only for diagnosing problems logging.INFO: Confirmation that things are working as expected logging.WARNING: Indication that something unexpected happened, but the program is still working logging.ERROR: Due to a more serious problem, the program couldn’t perform a function logging.CRITICAL: A serious error indicating the program may be unable to continue running For financial applications, consider using these levels to differentiate between routine calculations and potential issues:\ndef analyze_investment_portfolio(portfolio): logging.info(f\"Analyzing portfolio with {len(portfolio)} positions\") for position in portfolio: # Log routine information logging.debug(f\"Processing position: {position['ticker']}\") # Log potential concerns if position['allocation'] \u003e 0.20: # More than 20% in single position logging.warning(f\"High concentration in {position['ticker']}: {position['allocation']:.1%}\") # Log serious issues if position['value'] \u003c 0: logging.error(f\"Negative position value for {position['ticker']}: {position['value']}\") Handling Sensitive Financial Data in Logs Be careful not to log sensitive financial information:\n# BAD: Logging personal financial data logging.info(f\"Processing transaction for account {account_number}, balance: {balance}\") # GOOD: Log only what's necessary without exposing private data logging.info(f\"Processing transaction for account ending in {account_number[-4:]}\") Putting It All Together: A Complete Financial Testing Example Let’s bring everything together with a complete example for a financial calculator module:\n# financial_calculator.py from decimal import Decimal import logging # Set up logging logging.basicConfig( filename='financial_calculator.log', level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s' ) class FinancialError(Exception): \"\"\"Base class for financial calculation errors\"\"\" pass class NegativeValueError(FinancialError): \"\"\"Raised when a negative value is provided where it's not allowed\"\"\" pass class ZeroValueError(FinancialError): \"\"\"Raised when a zero value is provided where it's not allowed\"\"\" pass def npv(cash_flows, discount_rate): \"\"\" Calculate Net Present Value for a series of cash flows. Args: cash_flows (list): List of cash flows where the first element is typically negative (investment) discount_rate (float): Annual discount rate as a decimal (e.g., 0.1 for 10%) Returns: Decimal: Net Present Value rounded to 2 decimal places Raises: TypeError: If inputs are not in the expected format ValueError: If discount_rate is less than -1 \"\"\" logging.info(f\"Calculating NPV with discount rate: {discount_rate}\") logging.debug(f\"Cash flows: {cash_flows}\") if not isinstance(cash_flows, (list, tuple)): logging.error(\"Cash flows must be a list or tuple\") raise TypeError(\"Cash flows must be a list or tuple\") if not all(isinstance(cf, (int, float, Decimal)) for cf in cash_flows): logging.error(\"All cash flows must be numeric\") raise TypeError(\"All cash flows must be numeric\") if discount_rate \u003c -1: logging.error(f\"Invalid discount rate: {discount_rate}\") raise ValueError(\"Discount rate cannot be less than -100%\") # Convert to Decimal for precise financial calculations npv_value = Decimal('0') rate = Decimal(str(discount_rate)) for i, cf in enumerate(cash_flows): cf_decimal = Decimal(str(cf)) # Initial cash flow isn't discounted if i == 0: npv_value += cf_decimal else: npv_value += cf_decimal / (Decimal('1') + rate) ** Decimal(str(i)) logging.info(f\"NPV calculation result: {npv_value.quantize(Decimal('0.01'))}\") return npv_value.quantize(Decimal('0.01')) # Round to 2 decimal places def irr(cash_flows, guess=0.1, tolerance=0.0001, max_iterations=1000): \"\"\" Calculate Internal Rate of Return for a series of cash flows. Args: cash_flows (list): List of cash flows where the first element is typically negative guess (float): Initial guess for IRR tolerance (float): The calculation will stop when the result is within this tolerance max_iterations (int): Maximum number of iterations to perform Returns: float: The internal rate of return as a decimal Raises: ValueError: If calculation doesn't converge \"\"\" # Implementation using Newton's method # (Full implementation would go here) logging.info(\"IRR calculation requested\") # Simplified example return for brevity return 0.1548 And here’s how we would test this module:\n# test_financial_calculator.py import pytest from decimal import Decimal from financial_calculator import npv, irr, NegativeValueError, ZeroValueError class TestNPV: def test_basic_npv_calculation(self): # Initial investment of 1000, followed by 4 annual returns cash_flows = [-1000, 300, 400, 400, 300] assert npv(cash_flows, 0.1) == Decimal('152.92') def test_npv_with_all_positive_values(self): # All positive cash flows (unusual but mathematically valid) cash_flows = [1000, 300, 400, 500] assert npv(cash_flows, 0.1) \u003e Decimal('1000') def test_npv_with_high_discount_rate(self): cash_flows = [-1000, 300, 400, 400, 300] # High discount rate should reduce NPV assert npv(cash_flows, 0.25) \u003c npv(cash_flows, 0.1) def test_npv_with_invalid_input(self): # Test with non-list input with pytest.raises(TypeError): npv(\"not a list\", 0.1) # Test with non-numeric cash flows with pytest.raises(TypeError): npv([-1000, \"300\", 400], 0.1) # Test with invalid discount rate with pytest.raises(ValueError): npv([-1000, 300, 400], -1.5) # Can't have less than -100% discount class TestIRR: def test_basic_irr_calculation(self): cash_flows = [-1000, 300, 400, 400, 300] # Using almost equal because IRR can have small floating point differences assert abs(irr(cash_flows) - 0.1548) \u003c 0.0001 # Additional IRR tests would go here... # We could add more test classes for other financial functions Conclusion For finance professionals using Python, robust testing and debugging aren’t optional extras—they’re essential practices that ensure your calculations are reliable and accurate. By incorporating unit tests, effective debugging strategies, and structured logging into your workflow, you can build financial tools that you and your colleagues can trust.\nIn our next post, we’ll explore how to turn your financial scripts into proper command-line tools and automate routine financial tasks—a crucial skill for improving your productivity as a finance professional.\nPractice Exercises Create a simple function to calculate compound interest with different compounding periods, then write tests for it using pytest. Debug a financial calculation by setting breakpoints and using your IDE’s debugging tools. Implement a custom exception for a financial calculation and write a test that verifies it’s raised appropriately. Add structured logging to a financial script you’ve already written. Further Resources pytest Documentation Python Debugging with pdb Python’s logging Module Test-Driven Development by Example by Kent Beck Clean Code by Robert C. Martin ","wordCount":"2503","inLanguage":"en","image":"http://localhost:1313/site-feature-image.jpg","datePublished":"2025-06-19T00:00:00Z","dateModified":"2025-05-09T14:44:55+01:00","author":{"@type":"Person","name":"Michael Brunger"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/python-testing-debugging/"},"publisher":{"@type":"Organization","name":"Michael Brunger","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Michael Brunger (Alt + H)">Michael Brunger</a><div class=logo-switches></div></div><ul class="menu desktop-menu"><li><a href=http://localhost:1313/ title=Home><span>Home</span></a></li><li><a href=http://localhost:1313/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://localhost:1313/about/ title=About><span>About</span></a></li><li><a href=http://localhost:1313/links/ title=Links><span>Links</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://localhost:1313/contact/ title=Contact><span>Contact</span></a></li></ul><button id=menu-trigger class=hamburger-menu aria-haspopup=menu aria-label="Menu Button"><div class=hamburger-icon><span></span>
<span></span>
<span></span>
<span></span></div></button></nav></header><div class=mobile-menu-overlay><ul class=mobile-menu><li><a href=http://localhost:1313/>Home</a></li><li><a href=http://localhost:1313/posts/>Posts</a></li><li><a href=http://localhost:1313/about/>About</a></li><li><a href=http://localhost:1313/links/>Links</a></li><li><a href=http://localhost:1313/search/>Search</a></li><li><a href=http://localhost:1313/contact/>Contact</a></li></ul></div><main class=main><div class=reading-progress-container><div class=reading-progress-bar></div></div><script>console.log("Reading progress script loaded"),document.addEventListener("DOMContentLoaded",function(){console.log("DOM Content Loaded");const e=document.querySelector(".reading-progress-bar");if(console.log("Progress bar element:",e),!e){console.log("No progress bar found");return}window.addEventListener("scroll",function(){const n=window.innerHeight,s=document.documentElement.scrollHeight-n,o=window.scrollY,t=o/s*100;e.style.width=t+"%",console.log("Progress:",t+"%")})})</script><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Part 8: Testing & Debugging Python Code</h1><div class=post-description>Master unit testing with unittest and pytest, learn Test-Driven Development workflows, handle custom exceptions, use the debugger effectively, and implement structured logging.</div><div class=post-meta><span class=post-date><i class="far fa-calendar-alt"></i>
June 19, 2025
</span><span class=post-lastmod><i class="fas fa-edit"></i>
Last modified: May 9, 2025
</span><span class=post-reading-time><i class="far fa-clock"></i>
12 min read</span></div></header><div class=toc><details><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#why-testing-matters-in-finance>Why Testing Matters in Finance</a></li><li><a href=#unit-testing-basics>Unit Testing Basics</a><ul><li><a href=#getting-started-with-unittest>Getting Started with unittest</a></li><li><a href=#common-assertions-in-unittest>Common Assertions in unittest</a></li></ul></li><li><a href=#moving-to-pytest>Moving to pytest</a><ul><li><a href=#the-power-of-pytest-fixtures>The Power of pytest Fixtures</a></li><li><a href=#parameterised-tests-for-multiple-scenarios>Parameterised Tests for Multiple Scenarios</a></li></ul></li><li><a href=#test-driven-development-tdd-for-finance>Test-Driven Development (TDD) for Finance</a><ul><li><a href=#a-tdd-example-calculating-ebitda>A TDD Example: Calculating EBITDA</a></li></ul></li><li><a href=#debugging-financial-code>Debugging Financial Code</a><ul><li><a href=#print-driven-debugging>Print-Driven Debugging</a></li><li><a href=#using-pythons-built-in-debugger-pdb>Using Python&rsquo;s Built-in Debugger (pdb)</a></li><li><a href=#ide-based-debugging>IDE-Based Debugging</a></li><li><a href=#common-financial-code-bugs>Common Financial Code Bugs</a></li></ul></li><li><a href=#custom-exceptions-for-financial-validation>Custom Exceptions for Financial Validation</a></li><li><a href=#structured-logging-for-financial-applications>Structured Logging for Financial Applications</a><ul><li><a href=#logging-levels>Logging Levels</a></li><li><a href=#handling-sensitive-financial-data-in-logs>Handling Sensitive Financial Data in Logs</a></li></ul></li><li><a href=#putting-it-all-together-a-complete-financial-testing-example>Putting It All Together: A Complete Financial Testing Example</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#practice-exercises>Practice Exercises</a></li><li><a href=#further-resources>Further Resources</a></li></ul></nav></details></div><div class=post-content><h1 id=testing--debugging-building-reliable-financial-tools>Testing & Debugging: Building Reliable Financial Tools<a hidden class=anchor aria-hidden=true href=#testing--debugging-building-reliable-financial-tools>#</a></h1><p>When working with financial data and calculations, accuracy isn&rsquo;t just important—it&rsquo;s essential. A small bug in your code could mean reporting incorrect figures, making flawed investment decisions, or even compliance issues. This post will guide you through testing and debugging techniques that ensure your financial Python code works correctly and reliably.</p><h2 id=why-testing-matters-in-finance>Why Testing Matters in Finance<a hidden class=anchor aria-hidden=true href=#why-testing-matters-in-finance>#</a></h2><p>Imagine you&rsquo;ve created a Python script that calculates loan amortisation schedules. Your company uses this tool to price thousands of loans. If there&rsquo;s an error in your interest calculation logic, even a small one, the financial impact could be enormous.</p><p>As a finance professional, you need confidence in your code. Testing provides that confidence by systematically verifying that your calculations work correctly across a range of scenarios and edge cases.</p><h2 id=unit-testing-basics>Unit Testing Basics<a hidden class=anchor aria-hidden=true href=#unit-testing-basics>#</a></h2><p>Unit testing involves testing individual components (usually functions) in isolation to ensure they work as expected.</p><h3 id=getting-started-with-unittest>Getting Started with unittest<a hidden class=anchor aria-hidden=true href=#getting-started-with-unittest>#</a></h3><p>Python&rsquo;s built-in <code>unittest</code> framework provides all the tools you need for basic testing. Let&rsquo;s test our financial ratio calculator from the previous post:</p><p>First, create a file called <code>test_ratio_calculator.py</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> unittest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ratio_calculator <span style=color:#f92672>import</span> calculate_current_ratio, calculate_debt_to_equity
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestFinancialRatios</span>(unittest<span style=color:#f92672>.</span>TestCase):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_current_ratio</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test basic calculation</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>assertEqual(calculate_current_ratio(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>50000</span>), <span style=color:#ae81ff>2.0</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test with zero liabilities - should raise ValueError</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> self<span style=color:#f92672>.</span>assertRaises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>            calculate_current_ratio(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_debt_to_equity</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test basic calculation</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>assertEqual(calculate_debt_to_equity(<span style=color:#ae81ff>200000</span>, <span style=color:#ae81ff>400000</span>), <span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test highly leveraged company</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>assertEqual(calculate_debt_to_equity(<span style=color:#ae81ff>800000</span>, <span style=color:#ae81ff>200000</span>), <span style=color:#ae81ff>4.0</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test with zero equity - should raise ValueError</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> self<span style=color:#f92672>.</span>assertRaises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>            calculate_debt_to_equity(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    unittest<span style=color:#f92672>.</span>main()
</span></span></code></pre></div><p>Run the tests with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python test_ratio_calculator.py
</span></span></code></pre></div><p>If all tests pass, you&rsquo;ll see something like:</p><pre tabindex=0><code>..
----------------------------------------------------------------------
Ran 2 tests in 0.001s

OK
</code></pre><p>If a test fails, <code>unittest</code> will tell you which test failed and why, helping you pinpoint the issue.</p><h3 id=common-assertions-in-unittest>Common Assertions in unittest<a hidden class=anchor aria-hidden=true href=#common-assertions-in-unittest>#</a></h3><p>Here are some assertions particularly useful for financial calculations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Checking exact equality</span>
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>assertEqual(calculate_npv(cash_flows, <span style=color:#ae81ff>0.1</span>), <span style=color:#ae81ff>1025.79</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Checking approximate equality (for floating point calculations)</span>
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>assertAlmostEqual(calculate_irr([<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>600</span>]), <span style=color:#ae81ff>0.0734</span>, places<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Checking if a value is greater than another</span>
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>assertGreater(calculate_profit_margin(revenue, costs), <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Checking if an exception is raised for invalid inputs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> self<span style=color:#f92672>.</span>assertRaises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>    calculate_pe_ratio(stock_price<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>, earnings_per_share<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><h2 id=moving-to-pytest>Moving to pytest<a hidden class=anchor aria-hidden=true href=#moving-to-pytest>#</a></h2><p>While <code>unittest</code> is perfectly capable, <code>pytest</code> offers a more modern and flexible approach to testing. Let&rsquo;s see how we might test the same functions with <code>pytest</code>:</p><ol><li>Install pytest:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install pytest
</span></span></code></pre></div><ol start=2><li>Create a file named <code>test_ratios_pytest.py</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ratio_calculator <span style=color:#f92672>import</span> calculate_current_ratio, calculate_debt_to_equity
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_current_ratio_basic</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> calculate_current_ratio(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>50000</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_current_ratio_zero_liabilities</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> pytest<span style=color:#f92672>.</span>raises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>        calculate_current_ratio(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_debt_to_equity_basic</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> calculate_debt_to_equity(<span style=color:#ae81ff>200000</span>, <span style=color:#ae81ff>400000</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_debt_to_equity_high_leverage</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> calculate_debt_to_equity(<span style=color:#ae81ff>800000</span>, <span style=color:#ae81ff>200000</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>4.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_debt_to_equity_zero_equity</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> pytest<span style=color:#f92672>.</span>raises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>        calculate_debt_to_equity(<span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><ol start=3><li>Run the tests:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pytest test_ratios_pytest.py -v
</span></span></code></pre></div><p>The <code>-v</code> flag gives you verbose output showing each test that was run.</p><h3 id=the-power-of-pytest-fixtures>The Power of pytest Fixtures<a hidden class=anchor aria-hidden=true href=#the-power-of-pytest-fixtures>#</a></h3><p>One of pytest&rsquo;s most powerful features is fixtures, which let you set up preconditions for your tests. This is especially useful for financial testing where you might have complex data structures:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> financial_analyzer <span style=color:#f92672>import</span> StockAnalyzer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest.fixture</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sample_stock_data</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># Return a sample dataset that can be used by multiple tests</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;ticker&#39;</span>: <span style=color:#e6db74>&#39;AAPL&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;prices&#39;</span>: [<span style=color:#ae81ff>150.25</span>, <span style=color:#ae81ff>151.30</span>, <span style=color:#ae81ff>149.80</span>, <span style=color:#ae81ff>152.50</span>, <span style=color:#ae81ff>153.75</span>],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;volumes&#39;</span>: [<span style=color:#ae81ff>12345678</span>, <span style=color:#ae81ff>9876543</span>, <span style=color:#ae81ff>11234567</span>, <span style=color:#ae81ff>10234567</span>, <span style=color:#ae81ff>13456789</span>],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;financials&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;revenue&#39;</span>: <span style=color:#ae81ff>365.82</span>,  <span style=color:#75715e># In billions</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;net_income&#39;</span>: <span style=color:#ae81ff>94.68</span>,  <span style=color:#75715e># In billions</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;total_assets&#39;</span>: <span style=color:#ae81ff>351.0</span>,  <span style=color:#75715e># In billions</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;total_liabilities&#39;</span>: <span style=color:#ae81ff>287.91</span>,  <span style=color:#75715e># In billions</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;shareholders_equity&#39;</span>: <span style=color:#ae81ff>63.09</span>  <span style=color:#75715e># In billions</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_pe_ratio_calculation</span>(sample_stock_data):
</span></span><span style=display:flex><span>    analyzer <span style=color:#f92672>=</span> StockAnalyzer(sample_stock_data)
</span></span><span style=display:flex><span>    <span style=color:#75715e># Assuming current price is the last in the list and EPS is net_income / outstanding_shares</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># For this example, let&#39;s say outstanding_shares is 16.07B</span>
</span></span><span style=display:flex><span>    expected_pe <span style=color:#f92672>=</span> <span style=color:#ae81ff>150.25</span> <span style=color:#f92672>/</span> (<span style=color:#ae81ff>94.68</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>16.07</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> round(analyzer<span style=color:#f92672>.</span>calculate_pe_ratio(), <span style=color:#ae81ff>2</span>) <span style=color:#f92672>==</span> round(expected_pe, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_debt_to_equity_ratio</span>(sample_stock_data):
</span></span><span style=display:flex><span>    analyzer <span style=color:#f92672>=</span> StockAnalyzer(sample_stock_data)
</span></span><span style=display:flex><span>    expected_ratio <span style=color:#f92672>=</span> <span style=color:#ae81ff>287.91</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>63.09</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> round(analyzer<span style=color:#f92672>.</span>calculate_debt_to_equity(), <span style=color:#ae81ff>2</span>) <span style=color:#f92672>==</span> round(expected_ratio, <span style=color:#ae81ff>2</span>)
</span></span></code></pre></div><p>This way, you set up your test data once and reuse it across multiple tests.</p><h3 id=parameterised-tests-for-multiple-scenarios>Parameterised Tests for Multiple Scenarios<a hidden class=anchor aria-hidden=true href=#parameterised-tests-for-multiple-scenarios>#</a></h3><p>Financial calculations often need to be tested with multiple sets of inputs. Pytest&rsquo;s parameterisation makes this elegant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> finance_calcs <span style=color:#f92672>import</span> calculate_compound_interest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest.mark.parametrize</span>(<span style=color:#e6db74>&#34;principal,rate,time,compounding,expected&#34;</span>, [
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>0.05</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1276.28</span>),    <span style=color:#75715e># Annual compounding</span>
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>0.05</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>1283.36</span>),   <span style=color:#75715e># Monthly compounding</span>
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>0.05</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>365</span>, <span style=color:#ae81ff>1284.52</span>),  <span style=color:#75715e># Daily compounding</span>
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_compound_interest</span>(principal, rate, time, compounding, expected):
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> calculate_compound_interest(principal, rate, time, compounding)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> round(result, <span style=color:#ae81ff>2</span>) <span style=color:#f92672>==</span> expected
</span></span></code></pre></div><p>This tests our compound interest function with annual, monthly, and daily compounding periods, all in a single test function.</p><h2 id=test-driven-development-tdd-for-finance>Test-Driven Development (TDD) for Finance<a hidden class=anchor aria-hidden=true href=#test-driven-development-tdd-for-finance>#</a></h2><p>Test-Driven Development is a methodology where you write tests before you write code. For financial calculations, this approach can be particularly beneficial:</p><ol><li><strong>Write the test first</strong>: Define what your function should do before implementing it</li><li><strong>Run the test and watch it fail</strong>: Confirm the test works</li><li><strong>Write the implementation</strong>: Create the function to make the test pass</li><li><strong>Run the test again</strong>: Verify your implementation works</li><li><strong>Refactor</strong>: Clean up your code while ensuring tests continue to pass</li></ol><h3 id=a-tdd-example-calculating-ebitda>A TDD Example: Calculating EBITDA<a hidden class=anchor aria-hidden=true href=#a-tdd-example-calculating-ebitda>#</a></h3><p>Let&rsquo;s say we need to add an EBITDA calculation function. Following TDD:</p><ol><li>First, write the test:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># test_financial_metrics.py</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> financial_metrics <span style=color:#f92672>import</span> calculate_ebitda
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_calculate_ebitda</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># EBITDA = Net Income + Interest + Taxes + Depreciation + Amortisation</span>
</span></span><span style=display:flex><span>    income_statement <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;net_income&#39;</span>: <span style=color:#ae81ff>1000000</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;interest_expense&#39;</span>: <span style=color:#ae81ff>200000</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;income_tax&#39;</span>: <span style=color:#ae81ff>300000</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;depreciation&#39;</span>: <span style=color:#ae81ff>150000</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;amortisation&#39;</span>: <span style=color:#ae81ff>50000</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    expected_ebitda <span style=color:#f92672>=</span> <span style=color:#ae81ff>1700000</span>  <span style=color:#75715e># Sum of all the components</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> calculate_ebitda(income_statement) <span style=color:#f92672>==</span> expected_ebitda
</span></span></code></pre></div><ol start=2><li>Run the test (it will fail since we haven&rsquo;t implemented the function yet):</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pytest test_financial_metrics.py
</span></span></code></pre></div><ol start=3><li>Implement the function:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># financial_metrics.py</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_ebitda</span>(income_statement):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Calculate EBITDA from income statement components.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        income_statement (dict): Dictionary containing income statement items
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        float: EBITDA value
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>        income_statement[<span style=color:#e6db74>&#39;net_income&#39;</span>] <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        income_statement[<span style=color:#e6db74>&#39;interest_expense&#39;</span>] <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        income_statement[<span style=color:#e6db74>&#39;income_tax&#39;</span>] <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        income_statement[<span style=color:#e6db74>&#39;depreciation&#39;</span>] <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        income_statement[<span style=color:#e6db74>&#39;amortisation&#39;</span>]
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><ol start=4><li>Run the test again - it should pass now!</li></ol><h2 id=debugging-financial-code>Debugging Financial Code<a hidden class=anchor aria-hidden=true href=#debugging-financial-code>#</a></h2><p>Even with tests, bugs will sometimes creep into your code. Let&rsquo;s explore techniques to find and fix them.</p><h3 id=print-driven-debugging>Print-Driven Debugging<a hidden class=anchor aria-hidden=true href=#print-driven-debugging>#</a></h3><p>The simplest debugging technique is adding <code>print()</code> statements to your code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_loan_payment</span>(principal, annual_rate, years):
</span></span><span style=display:flex><span>    monthly_rate <span style=color:#f92672>=</span> annual_rate <span style=color:#f92672>/</span> <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Monthly rate: </span><span style=color:#e6db74>{</span>monthly_rate<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    num_payments <span style=color:#f92672>=</span> years <span style=color:#f92672>*</span> <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Number of payments: </span><span style=color:#e6db74>{</span>num_payments<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    payment <span style=color:#f92672>=</span> principal <span style=color:#f92672>*</span> (monthly_rate <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> monthly_rate) <span style=color:#f92672>**</span> num_payments) <span style=color:#f92672>/</span> \
</span></span><span style=display:flex><span>              ((<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> monthly_rate) <span style=color:#f92672>**</span> num_payments <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calculated payment: </span><span style=color:#e6db74>{</span>payment<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> payment
</span></span></code></pre></div><p>While simple, this approach can be effective for quick debugging sessions.</p><h3 id=using-pythons-built-in-debugger-pdb>Using Python&rsquo;s Built-in Debugger (pdb)<a hidden class=anchor aria-hidden=true href=#using-pythons-built-in-debugger-pdb>#</a></h3><p>For more complex issues, Python&rsquo;s debugger (pdb) gives you interactive control:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>analyze_portfolio</span>(holdings):
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> pdb; pdb<span style=color:#f92672>.</span>set_trace()  <span style=color:#75715e># Debugger will start here</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    total_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ticker, data <span style=color:#f92672>in</span> holdings<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        shares <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;shares&#39;</span>]
</span></span><span style=display:flex><span>        price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;current_price&#39;</span>]
</span></span><span style=display:flex><span>        position_value <span style=color:#f92672>=</span> shares <span style=color:#f92672>*</span> price
</span></span><span style=display:flex><span>        total_value <span style=color:#f92672>+=</span> position_value
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> total_value
</span></span></code></pre></div><p>When this code runs, it will pause at the <code>pdb.set_trace()</code> line and drop you into an interactive debugger. Common commands include:</p><ul><li><code>n</code> (next): Execute the current line and move to the next one</li><li><code>s</code> (step): Step into a function call</li><li><code>c</code> (continue): Continue execution until the next breakpoint</li><li><code>p variable_name</code>: Print the value of a variable</li><li><code>q</code> (quit): Exit the debugger</li></ul><h3 id=ide-based-debugging>IDE-Based Debugging<a hidden class=anchor aria-hidden=true href=#ide-based-debugging>#</a></h3><p>Most modern IDEs offer powerful visual debugging:</p><ol><li>Set a breakpoint by clicking in the margin next to your code</li><li>Start the debugger (usually with a &ldquo;Debug&rdquo; button)</li><li>The program will pause at your breakpoint</li><li>Examine variables, step through code, and find issues</li></ol><p>This is particularly useful for financial applications where you need to inspect complex data structures or track down calculation errors.</p><h3 id=common-financial-code-bugs>Common Financial Code Bugs<a hidden class=anchor aria-hidden=true href=#common-financial-code-bugs>#</a></h3><p>Watch out for these common issues in financial code:</p><ol><li><strong>Rounding errors</strong>: Financial calculations often require precise decimal handling</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Problematic: Floating point imprecision</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0.1</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.2</span>  <span style=color:#75715e># Returns 0.30000000000000004</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Better: Use Decimal for financial calculations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> decimal <span style=color:#f92672>import</span> Decimal
</span></span><span style=display:flex><span>Decimal(<span style=color:#e6db74>&#39;0.1&#39;</span>) <span style=color:#f92672>+</span> Decimal(<span style=color:#e6db74>&#39;0.2&#39;</span>)  <span style=color:#75715e># Returns Decimal(&#39;0.3&#39;)</span>
</span></span></code></pre></div><ol start=2><li><strong>Off-by-one errors in time periods</strong>: Check if your code correctly handles time period boundaries</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Is this calculating 29 or 30 days of interest?</span>
</span></span><span style=display:flex><span>days_in_month <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>daily_interest <span style=color:#f92672>=</span> principal <span style=color:#f92672>*</span> (annual_rate <span style=color:#f92672>/</span> <span style=color:#ae81ff>365</span>)
</span></span><span style=display:flex><span>total_interest <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Potential off-by-one error</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> day <span style=color:#f92672>in</span> range(days_in_month):  <span style=color:#75715e># This gives 0-29, so only 30 days</span>
</span></span><span style=display:flex><span>    total_interest <span style=color:#f92672>+=</span> daily_interest
</span></span></code></pre></div><ol start=3><li><strong>Negative input validation</strong>: Financial functions often have domain restrictions</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_loan_payment</span>(principal, rate, years):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Validate inputs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> principal <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Principal must be positive&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> rate <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Interest rate cannot be negative&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> years <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Loan term must be positive&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Rest of the calculation</span>
</span></span></code></pre></div><h2 id=custom-exceptions-for-financial-validation>Custom Exceptions for Financial Validation<a hidden class=anchor aria-hidden=true href=#custom-exceptions-for-financial-validation>#</a></h2><p>Creating custom exceptions helps make your financial code more robust and self-documenting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NegativePrincipalError</span>(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Raised when a negative principal amount is provided&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ZeroDivisionFinancialError</span>(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Raised when a financial calculation would result in division by zero&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_return_on_investment</span>(gain, cost):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Calculate ROI: (Gain - Cost) / Cost
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        gain (float): The amount gained from the investment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cost (float): The cost of the investment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        float: ROI as a decimal
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Raises:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        NegativePrincipalError: If cost is negative
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ZeroDivisionFinancialError: If cost is zero
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> cost <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> NegativePrincipalError(<span style=color:#e6db74>&#34;Investment cost cannot be negative&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> cost <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> ZeroDivisionFinancialError(<span style=color:#e6db74>&#34;Cannot calculate ROI with zero cost&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (gain <span style=color:#f92672>-</span> cost) <span style=color:#f92672>/</span> cost
</span></span></code></pre></div><p>These custom exceptions make error handling clearer and provide better feedback to users of your code.</p><h2 id=structured-logging-for-financial-applications>Structured Logging for Financial Applications<a hidden class=anchor aria-hidden=true href=#structured-logging-for-financial-applications>#</a></h2><p>For production financial applications, proper logging is essential for auditing and debugging:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set up logging</span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>basicConfig(
</span></span><span style=display:flex><span>    filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;financial_calculations.log&#39;</span>,
</span></span><span style=display:flex><span>    level<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO,
</span></span><span style=display:flex><span>    format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%(asctime)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(name)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(levelname)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(message)s</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_mortgage_payment</span>(principal, rate, years):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Calculate monthly mortgage payment&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calculating mortgage payment: principal=</span><span style=color:#e6db74>{</span>principal<span style=color:#e6db74>}</span><span style=color:#e6db74>, rate=</span><span style=color:#e6db74>{</span>rate<span style=color:#e6db74>}</span><span style=color:#e6db74>, years=</span><span style=color:#e6db74>{</span>years<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        monthly_rate <span style=color:#f92672>=</span> rate <span style=color:#f92672>/</span> <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>        num_payments <span style=color:#f92672>=</span> years <span style=color:#f92672>*</span> <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> monthly_rate <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            payment <span style=color:#f92672>=</span> principal <span style=color:#f92672>/</span> num_payments
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            payment <span style=color:#f92672>=</span> principal <span style=color:#f92672>*</span> (monthly_rate <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> monthly_rate) <span style=color:#f92672>**</span> num_payments) <span style=color:#f92672>/</span> \
</span></span><span style=display:flex><span>                      ((<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> monthly_rate) <span style=color:#f92672>**</span> num_payments <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calculated payment: </span><span style=color:#e6db74>{</span>payment<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> payment
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error calculating mortgage payment: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span>
</span></span></code></pre></div><p>This creates a log file with timestamped entries that can be invaluable for tracking down issues in complex financial applications.</p><h3 id=logging-levels>Logging Levels<a hidden class=anchor aria-hidden=true href=#logging-levels>#</a></h3><p>Different logging levels serve different purposes:</p><ul><li><code>logging.DEBUG</code>: Detailed information, typically useful only for diagnosing problems</li><li><code>logging.INFO</code>: Confirmation that things are working as expected</li><li><code>logging.WARNING</code>: Indication that something unexpected happened, but the program is still working</li><li><code>logging.ERROR</code>: Due to a more serious problem, the program couldn&rsquo;t perform a function</li><li><code>logging.CRITICAL</code>: A serious error indicating the program may be unable to continue running</li></ul><p>For financial applications, consider using these levels to differentiate between routine calculations and potential issues:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>analyze_investment_portfolio</span>(portfolio):
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Analyzing portfolio with </span><span style=color:#e6db74>{</span>len(portfolio)<span style=color:#e6db74>}</span><span style=color:#e6db74> positions&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> position <span style=color:#f92672>in</span> portfolio:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Log routine information</span>
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Processing position: </span><span style=color:#e6db74>{</span>position[<span style=color:#e6db74>&#39;ticker&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Log potential concerns</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> position[<span style=color:#e6db74>&#39;allocation&#39;</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.20</span>:  <span style=color:#75715e># More than 20% in single position</span>
</span></span><span style=display:flex><span>            logging<span style=color:#f92672>.</span>warning(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;High concentration in </span><span style=color:#e6db74>{</span>position[<span style=color:#e6db74>&#39;ticker&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>position[<span style=color:#e6db74>&#39;allocation&#39;</span>]<span style=color:#e6db74>:</span><span style=color:#e6db74>.1%</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Log serious issues</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> position[<span style=color:#e6db74>&#39;value&#39;</span>] <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            logging<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Negative position value for </span><span style=color:#e6db74>{</span>position[<span style=color:#e6db74>&#39;ticker&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>position[<span style=color:#e6db74>&#39;value&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=handling-sensitive-financial-data-in-logs>Handling Sensitive Financial Data in Logs<a hidden class=anchor aria-hidden=true href=#handling-sensitive-financial-data-in-logs>#</a></h3><p>Be careful not to log sensitive financial information:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># BAD: Logging personal financial data</span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Processing transaction for account </span><span style=color:#e6db74>{</span>account_number<span style=color:#e6db74>}</span><span style=color:#e6db74>, balance: </span><span style=color:#e6db74>{</span>balance<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># GOOD: Log only what&#39;s necessary without exposing private data</span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Processing transaction for account ending in </span><span style=color:#e6db74>{</span>account_number[<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>:]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h2 id=putting-it-all-together-a-complete-financial-testing-example>Putting It All Together: A Complete Financial Testing Example<a hidden class=anchor aria-hidden=true href=#putting-it-all-together-a-complete-financial-testing-example>#</a></h2><p>Let&rsquo;s bring everything together with a complete example for a financial calculator module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># financial_calculator.py</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> decimal <span style=color:#f92672>import</span> Decimal
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set up logging</span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>basicConfig(
</span></span><span style=display:flex><span>    filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;financial_calculator.log&#39;</span>,
</span></span><span style=display:flex><span>    level<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO,
</span></span><span style=display:flex><span>    format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%(asctime)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(name)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(levelname)s</span><span style=color:#e6db74> - </span><span style=color:#e6db74>%(message)s</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FinancialError</span>(<span style=color:#a6e22e>Exception</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Base class for financial calculation errors&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NegativeValueError</span>(FinancialError):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Raised when a negative value is provided where it&#39;s not allowed&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ZeroValueError</span>(FinancialError):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Raised when a zero value is provided where it&#39;s not allowed&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>npv</span>(cash_flows, discount_rate):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Calculate Net Present Value for a series of cash flows.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cash_flows (list): List of cash flows where the first element is typically negative (investment)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        discount_rate (float): Annual discount rate as a decimal (e.g., 0.1 for 10%)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Decimal: Net Present Value rounded to 2 decimal places
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Raises:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        TypeError: If inputs are not in the expected format
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ValueError: If discount_rate is less than -1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calculating NPV with discount rate: </span><span style=color:#e6db74>{</span>discount_rate<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Cash flows: </span><span style=color:#e6db74>{</span>cash_flows<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> isinstance(cash_flows, (list, tuple)):
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>error(<span style=color:#e6db74>&#34;Cash flows must be a list or tuple&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>TypeError</span>(<span style=color:#e6db74>&#34;Cash flows must be a list or tuple&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> all(isinstance(cf, (int, float, Decimal)) <span style=color:#66d9ef>for</span> cf <span style=color:#f92672>in</span> cash_flows):
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>error(<span style=color:#e6db74>&#34;All cash flows must be numeric&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>TypeError</span>(<span style=color:#e6db74>&#34;All cash flows must be numeric&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> discount_rate <span style=color:#f92672>&lt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Invalid discount rate: </span><span style=color:#e6db74>{</span>discount_rate<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Discount rate cannot be less than -100%&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Convert to Decimal for precise financial calculations</span>
</span></span><span style=display:flex><span>    npv_value <span style=color:#f92672>=</span> Decimal(<span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>    rate <span style=color:#f92672>=</span> Decimal(str(discount_rate))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, cf <span style=color:#f92672>in</span> enumerate(cash_flows):
</span></span><span style=display:flex><span>        cf_decimal <span style=color:#f92672>=</span> Decimal(str(cf))
</span></span><span style=display:flex><span>        <span style=color:#75715e># Initial cash flow isn&#39;t discounted</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            npv_value <span style=color:#f92672>+=</span> cf_decimal
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            npv_value <span style=color:#f92672>+=</span> cf_decimal <span style=color:#f92672>/</span> (Decimal(<span style=color:#e6db74>&#39;1&#39;</span>) <span style=color:#f92672>+</span> rate) <span style=color:#f92672>**</span> Decimal(str(i))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;NPV calculation result: </span><span style=color:#e6db74>{</span>npv_value<span style=color:#f92672>.</span>quantize(Decimal(<span style=color:#e6db74>&#39;0.01&#39;</span>))<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> npv_value<span style=color:#f92672>.</span>quantize(Decimal(<span style=color:#e6db74>&#39;0.01&#39;</span>))  <span style=color:#75715e># Round to 2 decimal places</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>irr</span>(cash_flows, guess<span style=color:#f92672>=</span><span style=color:#ae81ff>0.1</span>, tolerance<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0001</span>, max_iterations<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Calculate Internal Rate of Return for a series of cash flows.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cash_flows (list): List of cash flows where the first element is typically negative
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        guess (float): Initial guess for IRR
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        tolerance (float): The calculation will stop when the result is within this tolerance
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        max_iterations (int): Maximum number of iterations to perform
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        float: The internal rate of return as a decimal
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Raises:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ValueError: If calculation doesn&#39;t converge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Implementation using Newton&#39;s method</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># (Full implementation would go here)</span>
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;IRR calculation requested&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># Simplified example return for brevity</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.1548</span>
</span></span></code></pre></div><p>And here&rsquo;s how we would test this module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># test_financial_calculator.py</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> decimal <span style=color:#f92672>import</span> Decimal
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> financial_calculator <span style=color:#f92672>import</span> npv, irr, NegativeValueError, ZeroValueError
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestNPV</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_basic_npv_calculation</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Initial investment of 1000, followed by 4 annual returns</span>
</span></span><span style=display:flex><span>        cash_flows <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>300</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> npv(cash_flows, <span style=color:#ae81ff>0.1</span>) <span style=color:#f92672>==</span> Decimal(<span style=color:#e6db74>&#39;152.92&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_npv_with_all_positive_values</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># All positive cash flows (unusual but mathematically valid)</span>
</span></span><span style=display:flex><span>        cash_flows <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>500</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> npv(cash_flows, <span style=color:#ae81ff>0.1</span>) <span style=color:#f92672>&gt;</span> Decimal(<span style=color:#e6db74>&#39;1000&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_npv_with_high_discount_rate</span>(self):
</span></span><span style=display:flex><span>        cash_flows <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>300</span>]
</span></span><span style=display:flex><span>        <span style=color:#75715e># High discount rate should reduce NPV</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> npv(cash_flows, <span style=color:#ae81ff>0.25</span>) <span style=color:#f92672>&lt;</span> npv(cash_flows, <span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_npv_with_invalid_input</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test with non-list input</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> pytest<span style=color:#f92672>.</span>raises(<span style=color:#a6e22e>TypeError</span>):
</span></span><span style=display:flex><span>            npv(<span style=color:#e6db74>&#34;not a list&#34;</span>, <span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test with non-numeric cash flows</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> pytest<span style=color:#f92672>.</span>raises(<span style=color:#a6e22e>TypeError</span>):
</span></span><span style=display:flex><span>            npv([<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#34;300&#34;</span>, <span style=color:#ae81ff>400</span>], <span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Test with invalid discount rate</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> pytest<span style=color:#f92672>.</span>raises(<span style=color:#a6e22e>ValueError</span>):
</span></span><span style=display:flex><span>            npv([<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>400</span>], <span style=color:#f92672>-</span><span style=color:#ae81ff>1.5</span>)  <span style=color:#75715e># Can&#39;t have less than -100% discount</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestIRR</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_basic_irr_calculation</span>(self):
</span></span><span style=display:flex><span>        cash_flows <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>300</span>]
</span></span><span style=display:flex><span>        <span style=color:#75715e># Using almost equal because IRR can have small floating point differences</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> abs(irr(cash_flows) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.1548</span>) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.0001</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Additional IRR tests would go here...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># We could add more test classes for other financial functions</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>For finance professionals using Python, robust testing and debugging aren&rsquo;t optional extras—they&rsquo;re essential practices that ensure your calculations are reliable and accurate. By incorporating unit tests, effective debugging strategies, and structured logging into your workflow, you can build financial tools that you and your colleagues can trust.</p><p>In our next post, we&rsquo;ll explore how to turn your financial scripts into proper command-line tools and automate routine financial tasks—a crucial skill for improving your productivity as a finance professional.</p><h2 id=practice-exercises>Practice Exercises<a hidden class=anchor aria-hidden=true href=#practice-exercises>#</a></h2><ol><li>Create a simple function to calculate compound interest with different compounding periods, then write tests for it using pytest.</li><li>Debug a financial calculation by setting breakpoints and using your IDE&rsquo;s debugging tools.</li><li>Implement a custom exception for a financial calculation and write a test that verifies it&rsquo;s raised appropriately.</li><li>Add structured logging to a financial script you&rsquo;ve already written.</li></ol><h2 id=further-resources>Further Resources<a hidden class=anchor aria-hidden=true href=#further-resources>#</a></h2><ul><li><a href=https://docs.pytest.org/>pytest Documentation</a></li><li><a href=https://docs.python.org/3/library/pdb.html>Python Debugging with pdb</a></li><li><a href=https://docs.python.org/3/library/logging.html>Python&rsquo;s logging Module</a></li><li><a href=https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530/>Test-Driven Development by Example</a> by Kent Beck</li><li><a href=https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882/>Clean Code</a> by Robert C. Martin</li></ul></div><div class=related-posts><h2>Related Posts</h2><div class=related-posts-grid><article class=related-post><a href=http://localhost:1313/python-foundations-editors-ides/ class=related-post-link><div class=related-post-content><h3 class=related-post-title>Part 2: Text Editors vs. IDEs for Python Development</h3><p class=related-post-description>Compare lightweight text editors to full-featured IDEs for Python development. Learn how to set up VS Code with essential Python extensions and discover effective debugging techniques.</p><div class=related-post-meta><time datetime=2025-05-01>May 1, 2025</time><span class=related-post-tags><span class=tag>python</span></span></div></div></a></article><article class=related-post><a href=http://localhost:1313/python-next-steps-advanced-topics/ class=related-post-link><div class=related-post-content><h3 class=related-post-title>Part 17: Next Steps & Advanced Python Topics</h3><p class=related-post-description>Explore advanced Python topics including concurrency, asyncio, and complete an end-to-end project. Discover resources for further learning and tips for continuing your Python journey.</p><div class=related-post-meta><time datetime=2025-08-21>August 21, 2025</time><span class=related-post-tags><span class=tag>python</span></span></div></div></a></article><article class=related-post><a href=http://localhost:1313/simple-gui-applications-tkinter/ class=related-post-link><div class=related-post-content><h3 class=related-post-title>Part 16: Building Simple GUI Applications with Tkinter</h3><p class=related-post-description>Create desktop applications with Python's built-in Tkinter library. Learn about widgets, layout managers, and build a practical mini-project with a graphical user interface.</p><div class=related-post-meta><time datetime=2025-08-14>August 14, 2025</time><span class=related-post-tags><span class=tag>python</span></span></div></div></a></article></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/python>python</a></li><li><a href=http://localhost:1313/tags/testing>testing</a></li><li><a href=http://localhost:1313/tags/unittest>unittest</a></li><li><a href=http://localhost:1313/tags/pytest>pytest</a></li><li><a href=http://localhost:1313/tags/debugging>debugging</a></li><li><a href=http://localhost:1313/tags/pdb>pdb</a></li><li><a href=http://localhost:1313/tags/exceptions>exceptions</a></li><li><a href=http://localhost:1313/tags/logging>logging</a></li><li><a href=http://localhost:1313/tags/tdd>TDD</a></li></ul><div class=share-buttons><a href="https://twitter.com/intent/tweet?text=Part%208%3a%20Testing%20%26%20Debugging%20Python%20Code&url=http%3a%2f%2flocalhost%3a1313%2fpython-testing-debugging%2f" target=_blank rel=noopener aria-label="Share on Twitter"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3a%2f%2flocalhost%3a1313%2fpython-testing-debugging%2f" target=_blank rel=noopener aria-label="Share on LinkedIn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpython-testing-debugging%2f" target=_blank rel=noopener aria-label="Share on Facebook"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
</a><a href="https://wa.me/?text=Part%208%3a%20Testing%20%26%20Debugging%20Python%20Code%20http%3a%2f%2flocalhost%3a1313%2fpython-testing-debugging%2f" target=_blank rel=noopener aria-label="Share on WhatsApp"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.15-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.375-.025-.524-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2.0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345m-5.446 7.443h-.016c-1.77.0-3.524-.48-5.055-1.38l-.36-.214-3.75.975 1.005-3.645-.239-.375c-.99-1.576-1.516-3.391-1.516-5.26.0-5.445 4.455-9.885 9.942-9.885a9.865 9.865.0 017.021 2.91 9.788 9.788.0 012.909 6.99c-.004 5.444-4.46 9.885-9.935 9.885M20.52 3.449C18.24 1.245 15.24.0 12.045.0 5.463.0.104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652a12.062 12.062.0 005.71 1.447h.006c6.585.0 11.946-5.336 11.949-11.896.0-3.176-1.24-6.165-3.495-8.411"/></svg>
</a><a href="mailto:?subject=Part%208%3a%20Testing%20%26%20Debugging%20Python%20Code&body=http%3a%2f%2flocalhost%3a1313%2fpython-testing-debugging%2f" aria-label="Share via Email"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Michael Brunger</a> |</span>
<span class=footer-links><a href=mailto:michaelbrunger@gmail.com rel="me noopener" target=_blank>Email</a> |
<a href=https://linkedin.com/in/michael-brunger rel="me noopener" target=_blank>LinkedIn</a> |
<a href=http://localhost:1313/terms/ rel=noopener>Terms</a> |
<a href=http://localhost:1313/privacy/ rel=noopener>Privacy</a></span></footer><div id=back-to-top-container><button id=back-to-top class=back-to-top aria-label="Back to top"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg></button></div><script language=javascript type=text/javascript src=http://localhost:1313/menu-trigger.min.1fdaaaa006c69ae56d0620f2af3adf4d9e797e66d323215185b85818508bac37.js></script></body></html>